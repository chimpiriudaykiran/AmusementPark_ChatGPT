<!DOCTYPE html>
<html lang="en-US">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Fantasy Island</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./static/css/style.css" type="text/css" />

    <!-- Ionic icons -->
    <link href="https://unpkg.com/ionicons@4.2.0/dist/css/ionicons.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        /* Your custom styles here */
    </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-default navbar-expand-lg fixed-top custom-navbar">
    <!-- Navbar content here -->
</nav>
<!-- End Navbar -->

<div class="container" style="margin-top: 80px;">
    <h2>Buy Tickets</h2>

    <div class="ui input">
        <label for="email"><h4>Email</h4></label>
        <input type="email" placeholder="Email" id="email" style="width: 250px;">
        <label for="name"><h4>Name</h4></label>
        <input type="text" placeholder="Name" id="name" style="width: 250px;">
    </div>

    <h4>Booking Date</h4>
    <div class="ui calendar" id="booking-date">
        <!-- Calendar input here -->
    </div>

    <div class="number">
        <label for="adultcount"><h4>Adults(18+)</h4></label>
        <span class="minus">-</span>
        <input type="text" id="adultcount" value="0"/>
        <span class="plus">+</span>
    </div>

    <div class="number">
        <label for="childcount"><h4>Children(5-17)</h4></label>
        <span class="minus">-</span>
        <input type="text" id="childcount" value="0"/>
        <span class="plus">+</span>
    </div>

    <button class="ui button primary" onclick="submitForm()">Submit</button>
</div>

<!-- External JavaScripts -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui-calendar@1.0.1-rc.6/dist/calendar.min.js"></script>

<script>
    $('#booking-date').calendar({
        type: 'date'
    });

    $(document).ready(function() {
        $('.minus').click(function () {
            var $input = $(this).parent().find('input');
            var count = parseInt($input.val()) - 1;
            count = count < 1 ? 1 : count;
            $input.val(count);
            $input.change();
            return false;
        });
        $('.plus').click(function () {
            var $input = $(this).parent().find('input');
            $input.val(parseInt($input.val()) + 1);
            $input.change();
            return false;
        });
    });

    function submitForm() {
        var bookingDate = document.getElementById("bookingdate").value;
        var email = document.getElementById("email").value;
        var name = document.getElementById("name").value;
        var adultcount = document.getElementById("adultcount").value;
        var childcount = document.getElementById("childcount").value;
        // Generate random transaction ID and amount
        var transactionID = Math.floor(Math.random() * 1000000); // Random transaction ID
        var amountPaid = Math.random() * 1000; // Random amount paid
        var dueamount = 0;

        // Create an object with the form data
        var formData = {
            "emailid": email,
            "Name": name,
            "AdultCount": adultcount,
            "ChildCount": childcount,
            "entryDate": bookingDate,
            "TransactionID": transactionID,
            "AmountPaid": amountPaid,
            "DueAmount": dueamount
        };

        // Send the data to the server using fetch API
        fetch('/buytickets', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then((responsetext) => {
                        console.error(responsetext.message);
                        throw new Error(responsetext.message);
                    });
                } else {
                    return response.json();
                }
            })
            .then(data => {
                console.log('Success:', data);
                // Show popup with ticket ID details
                alert(data.message + "\nTicket ID: " + data.TicketID);
            })
            .catch(error => {
                console.error('Error:', error);
                // Optionally, you can handle error response here
            });
    }
</script>

</body>
</html>
